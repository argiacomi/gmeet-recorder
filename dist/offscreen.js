import{l as g,L as p}from"./lib/logger.js";const r=(...o)=>g(p.Offscreen,...o);r("Offscreen script loaded");let e,i=[],d=!1;const a=chrome.runtime.connect({name:"offscreen"});a.onMessage.addListener(async o=>{try{switch(o.type){case"start-recording":await l(o.tabId);break;case"pause-recording":case"resume-recording":await u();break;case"stop-recording":await c();break}}catch(t){r("Error handling message:",t)}});async function l(o){if(d)return r("Error: Recording already in Progress"),!1;i=[];try{const t=await navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0});return r("Sending back message:",o),a.postMessage({type:"screen-picked",tabId:o}),e=new MediaRecorder(t,{mimeType:"video/webm"}),e.ondataavailable=s=>{i.push(s.data)},e.stop=f,e.start(100),d=!0,r("Recording Started"),a.postMessage({type:"recording-started"}),!0}catch(t){return d=!1,e=null,r("Error starting recording:",t),!1}}function u(){e&&e.state==="recording"?(e.pause(),a.postMessage({type:"recording-paused"}),r("Recording Paused")):e&&e.state==="paused"?(e.resume(),a.postMessage({type:"recording-resumed"}),r("Recording Resumed")):r("Error: No Recording")}function c(){e&&(e.state==="recording"||e.state==="paused")?(e.stop(),e.stream.getTracks().forEach(o=>{o.stop()}),e=null,d=!1,r("Recording Stopped"),a.postMessage({type:"recording-stopped"})):r("Error: No Recording")}function f(){try{r("Saving video recording");const o=new Blob(i,{type:"video/webm"}),t=URL.createObjectURL(o),s=`video_recording_${new Date().toISOString()}.webm`,n=document.createElement("a");return n.style.display="none",n.href=t,n.download=s,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(t),document.body.removeChild(n),i=[],r("Video recording saved",s),a.postMessage({type:"recording-complete",filename:s}),!0}catch(o){return r("Error saving recording:",o),!1}}window.addEventListener("beforeunload",async()=>{d&&(c(),r("Recording stopped due to page unload"))});
